<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>www.Melvinshop.co.ke</title>
<style>
html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    background-color: #f5f6fa;
}

/* Header */
.header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: #40739e;
    color: white;
    padding: 10px 20px;
    box-sizing: border-box;
    position: sticky;
    top: 0;
    z-index: 50;
}

/* Header title */
.header h1 {
    margin: 0;
    font-size: 20px;
    text-align: center;
    flex: 1;
}

/* Left and right button group */
.header-right {
    display: flex;
    align-items: center;
    gap: 5px; /* small gap between search and download button */
}

/* Back button */
a.back-btn {
    background-color: #e84118;
    color: white;
    padding: 8px 14px;
    border-radius: 5px;
    text-decoration: none;
    font-weight: bold;
}
a.back-btn:hover {
    background-color: #c23616;
}

/* Download button */
a.save-btn {
    background-color: #ff69b4;
    color: white;
    padding: 8px 14px;
    border-radius: 5px;
    text-decoration: none;
    font-weight: bold;
    transition: 0.3s ease;
}
a.save-btn:hover {
    background-color: #ff85c1;
}

/* Search input */
input.search-input {
    padding: 6px 10px;
    border-radius: 5px;
    border: none;
    font-size: 14px;
}

/* Table container fills remaining height */
.table-container {
    width: 100%;
    height: calc(100vh - 60px); /* viewport height minus header height */
    overflow-y: auto;
    margin: 0;
}

/* Table styling */
table {
    width: 100%;
    border-collapse: collapse;
    margin: 0;
}

th, td {
    padding: 8px;
    border: 1px solid #ccc;
    text-align: left;
    font-size: 14px;
}

th {
    background-color: #40739e;
    color: white;
    position: sticky;
    top: 0; /* sticks inside table container */
    z-index: 40;
}

td {
    background-color: white;
}

/* Delete button styling */
button.delete-btn {
    background-color: #e84118;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 5px;
    cursor: pointer;
}
button.delete-btn:hover {
    background-color: #c23616;
}

/* Responsive adjustment */
@media screen and (max-width: 768px) {
    .header {
        flex-direction: column;
        align-items: stretch;
    }
    .header h1 {
        margin: 5px 0;
    }
    .header-right {
        justify-content: flex-start;
        margin-top: 5px;
    }
    a.back-btn, a.save-btn {
        width: 100%;
        text-align: center;
        margin: 5px 0;
    }
    input.search-input {
        width: 100%;
        margin: 5px 0 0 0;
    }
}
</style>
</head>
<body>

<!-- Header -->
<div class="header">
    <a href="/" class="back-btn">← Back to Dashboard</a>
    <h1>Price Variation Dashboard</h1>
    <div class="header-right">
        <a href="/download-price-variation" class="save-btn">⬇ Download Report</a>
        <input type="text" class="search-input" placeholder="Search..." onkeyup="filterTable()">
    </div>
</div>

<!-- Table -->
<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>ITEM</th>
                <th>DESCRIPTION</th>
                <th>OLD PRICE</th>
                <th>NEW PRICE</th>
                <th>CHANGE DATE</th>
                <th>ACTION</th>
            </tr>
        </thead>
        <tbody>
        {% for item, info in data.items() %}
            {% for change in info.variations %}
            <tr>
                <td>{{ item }}</td>
                <td>{{ info.description }}</td>
                <td>{{ change.old_price }}</td>
                <td>{{ change.new_price }}</td>
                <td>{{ change.change_date }}</td>
                <td>
                    <form action="{{ url_for('delete_price_variation', variation_id=change.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this entry?');">
                        <button type="submit" class="delete-btn">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        {% endfor %}
        </tbody>
    </table>
</div>

<script>
function filterTable() {
    const input = document.querySelector('.search-input').value.toLowerCase();
    const rows = document.querySelectorAll('.table-container tbody tr');
    rows.forEach(row => {
        row.style.display = Array.from(row.cells).some(cell =>
            cell.textContent.toLowerCase().includes(input)
        ) ? '' : 'none';
    });
}
</script>

</body>
</html>
